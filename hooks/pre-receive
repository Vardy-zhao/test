#!/bin/bash

while read oldrev newrev refname; do
    # 提取提交的更改内容
    changes=$(git diff-tree --no-commit-id --name-only -r $newrev)

    # 检查README.md是否有修改
    if echo "$changes" | grep -q "README.md"; then
        # 获取README.md中的错误代码
        error_codes=$(git show $newrev:README.md | grep -oP "ERROR_CODE_\w+")

        # 检测是否有重复的错误代码
        duplicates=$(echo "$error_codes" | sort | uniq -d)

        if [ -n "$duplicates" ]; then
            echo "Error: Detected duplicate error codes in README.md in commit $newrev:"
            echo "$duplicates"
            exit 1  # 非零退出码将阻止提交
        fi
    fi
done

exit 0  # 0退出码允许提交